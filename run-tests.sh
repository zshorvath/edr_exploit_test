SCRIPT_DIR="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"

rm -f "$SCRIPT_DIR"/config/nexttest.yaml 


#"$SCRIPT_DIR"/init_vm.sh

docker network create edrtest

cd "$SCRIPT_DIR"/upload_server
./docker-run.sh

cd "$SCRIPT_DIR"/vulnerable_box

"$SCRIPT_DIR"/docker-run-nexttest.sh
while [ -f "$SCRIPT_DIR"/config/nexttest.yaml ]
do
    vagrant snapshot restore vulnerbox
    "$SCRIPT_DIR"/docker-run.sh
    vagrant halt
    "$SCRIPT_DIR"/docker-run-nexttest.sh
    sleep 2 # or less like 0.2
done

cd "$SCRIPT_DIR"