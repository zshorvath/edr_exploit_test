import base64
import hmac
import hashlib
import requests
import urllib

def fragments(url_template, timeout, payload, app_secret):
	encoded_payload = urllib.parse.quote_plus(base64.b64encode(payload.encode()))
	print("encoded_payload={}".format(encoded_payload))
	url = url_template.replace("##PAYLOAD##", encoded_payload)
	print("url_template={}".format(url_template))
	hash = base64.b64encode(hmac.HMAC(app_secret.encode(), url.encode(), hashlib.sha256).digest()).decode('utf-8')
	hash = urllib.parse.quote_plus(hash)
	url = "{}&_hash={}".format(url, hash)
	print("url={}".format(url))

	requests.get(url=url, timeout=timeout, verify=False)

