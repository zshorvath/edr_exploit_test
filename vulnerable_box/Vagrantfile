Vagrant.configure("2") do |config|

  config.vm.provider "virtualbox" do |v|
    v.gui = true
  end

  config.vm.box = "zshorvath/vulnerable_sympfony"
  config.vm.box_version = "2"
  if Vagrant.has_plugin?("vagrant-vbguest") then
    config.vbguest.auto_update = false
  end

  config.vm.provision "shell", inline: "hostnamectl set-hostname \"edr-stretch-$(date '+%F-%H-%M-%S').localdomain\""
  config.vm.provision "shell", inline: "sed -i \"s/edr\\-stretch\\-[[:digit:]]\\{4\\}\\-[[:digit:]]\\{2\\}\\-[[:digit:]]\\{2\\}\\-[[:digit:]]\\{2\\}\\-[[:digit:]]\\{2\\}\\-[[:digit:]]\\{2\\}\\.localdomain/$(hostname)/g\" /etc/hosts"
  config.vm.provision :shell, inline: "service php7.4-fpm restart", privileged: true, run: "always"
  config.vm.provision "shell", inline: "systemctl restart nginx", privileged: true, run: "always"

  # Falcon
  #config.vm.provision "file", source: "falcon/falcon-sensor_6.32.0-12904_amd64.deb", #destination: "/tmp/falcon-sensor_6.32.0-12904_amd64.deb"
  #config.vm.provision :shell, path: "falcon/falcon.sh"
  
  # Sentinal 1
  #config.vm.provision "file", source: "s1/SentinelAgent-linux-v21-10-3-3_linux_v21_10_3_3.deb", #destination: "/tmp/SentinelAgent-linux-v21-10-3-3_linux_v21_10_3_3.deb"
  #config.vm.provision "file", source: "s1/s1.key", destination: "/tmp/s1.key"
  #config.vm.provision :shell, path: "s1/s1.sh"

  #MDE
  #config.vm.provision "file", source: "mde/MicrosoftDefenderATPOnboardingLinuxServer.py", #destination: "/tmp/MicrosoftDefenderATPOnboardingLinuxServer.py"
  #config.vm.provision :shell, path: "mde/mde.sh"

  config.vm.network "forwarded_port", guest: 80, host: 8088
end