#!/bin/bash
SCRIPT_DIR="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
macos_version=`type defaults >/dev/null 2>&1 && defaults read loginwindow SystemVersionStampAsString || echo "Not MacOS"`
printf "$macos_version\n"

cd "$SCRIPT_DIR"/vulnerable_box
if  [[ $macos_version == 12.* ]];
then
    printf "Applying MacOS kernel module load problem\n";
    sudo ./monterey_hotfix.sh
fi

vagrant destroy
vagrant up
vagrant halt
vagrant snapshot save vulnerbox